<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>高雄市托育/嬰服務中心</title>
    <link rel="stylesheet" href="./assets/stylesheets/layout.css">
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.24/vue.min.js"></script>
</head>

<body>
    <div class="header">
        <a href="/">
            <div class="header-title"><img src="assets/images/bottle.png" />高雄市托育/嬰服務中心</div>
        </a>
    </div>
    <div class="wrap">
        <div class="left-container">

            <h1><img src="assets/images/bottle.png"/>托嬰中心查詢</h1>
            <div id="nurserysList">
                區:
                <select v-model="currentArea">
                    <option>全部地區</option>
                    <option v-for="area in areas">
                        {{area}}
                    </option>
                </select>
                <ul>
                    <template v-for="item in items">
                        <template v-if="currentArea=='全部地區'">
                            <li>{{item.org_Text}}</li>
                        </template>
                        <template v-if="item.area==currentArea">
                            <li>{{item.org_Text}}</li>
                        </template>
                    </template>
                </ul>
            </div>
            <script>
                var apiURL = 'http://data.kaohsiung.gov.tw/Opendata/DownLoad.aspx?Type=2&CaseNo1=AE&CaseNo2=2&FileType=1&Lang=C&FolderType=';
                var apiURL2 = 'http://data.kaohsiung.gov.tw/Opendata/DownLoad.aspx?Type=2&CaseNo1=AE&CaseNo2=1&FileType=1&Lang=C&FolderType=';
                var nurserysList = new Vue({
                    el: '#nurserysList'
                    , data: {
                        currentArea: '全部地區'
                        , items: []
                        , areas: []
                    }
                    , created: function () {
                        this.fetchData();
                    }
                    , methods: {
                        fetchData: function () {
                            var self = this;
                            $.ajax({
                                type: 'GET'
                                , url: apiURL
                                , async: false
                                , success: function (data) {
                                    var thisData = JSON.parse(data);
                                    for (var i in thisData) {
                                        self.items.push(thisData[i]);
                                    }
                                }
                            });
                            $.ajax({
                                type: 'GET'
                                , url: apiURL2
                                , async: false
                                , success: function (data) {
                                    var thisData = JSON.parse(data);
                                    for (var i in thisData) {
                                        self.items.push(thisData[i]);
                                    }
                                }
                            });
                            var areaGroup = {};
                            for (var i in self.items) {
                                self.items[i].area = self.items[i].informaddress.substr(3, 3);
                                var key = self.items[i].area;
                                areaGroup[key] = areaGroup[key] || (areaGroup[key] = []);
                                areaGroup[key].push(self.items[i].org_Text);
                            }
                            self.areas = Object.keys(areaGroup);
                            console.log(JSON.stringify(areaGroup));
                        }
                    }
                });
            </script>

        </div>
        <div class="right-container"></div>
    </div>
    <div class="footer">
        <p>Copyright © 2016 史卯郁 楊竑昕 All rights reserved</p>
    </div>
</body>

</html>
